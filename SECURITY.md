# Безопасность

## Реализованные меры безопасности

### 1. Rate Limiting (Ограничение частоты запросов)

- **Защита от DDoS**: Ограничение количества запросов с одного IP
- **Защита от брутфорса**: Строгие лимиты для auth эндпоинтов
- **Настройки**:
  - Обычные эндпоинты: 60 запросов в минуту
  - Auth эндпоинты: 5 запросов в минуту
  - Настраивается в `.env`: `RATE_LIMIT_ENABLED`, `RATE_LIMIT_PER_MINUTE`, `RATE_LIMIT_AUTH_PER_MINUTE`

### 2. Заголовки безопасности

- `X-Content-Type-Options: nosniff` - Защита от MIME-sniffing
- `X-Frame-Options: DENY` - Защита от clickjacking
- `X-XSS-Protection: 1; mode=block` - Защита от XSS
- `Strict-Transport-Security` - Принудительное использование HTTPS
- `Referrer-Policy` - Контроль передачи referrer
- `Permissions-Policy` - Ограничение доступа к API браузера

### 3. Ограничение размера запросов

- Максимальный размер запроса: 1MB (настраивается в `.env`: `MAX_REQUEST_SIZE`)
- Защита от переполнения буфера

### 4. Обработка ошибок

- Скрытие деталей ошибок в продакшене (настраивается в `.env`: `HIDE_ERROR_DETAILS`)
- Логирование всех ошибок для администратора
- Безопасные сообщения об ошибках для клиентов

### 5. JWT токены

- Токены с ограниченным временем жизни
- Черный список отозванных токенов
- Проверка токенов при каждом запросе
- Автоматическая инвалидация при logout

### 6. Валидация входных данных

- Валидация всех входных данных через Pydantic
- Защита от SQL инъекций через параметризованные запросы SQLAlchemy
- Валидация формата номеров телефонов
- Валидация длины и формата данных

### 7. Хеширование паролей

- Использование bcrypt для хеширования паролей
- Соль добавляется автоматически
- Пароли никогда не хранятся в открытом виде

### 8. CORS настройки

- Настраиваемые разрешенные источники
- Ограниченные методы HTTP
- Контроль заголовков

## Рекомендации для продакшена

1. **Измените SECRET_KEY** на сложный случайный ключ
2. **Включите HTTPS** и настройте SSL сертификаты
3. **Настройте CORS_ORIGINS** на конкретные домены
4. **Включите HIDE_ERROR_DETAILS** в продакшене
5. **Настройте логирование** для мониторинга безопасности
6. **Используйте Redis** для rate limiting в продакшене (опционально)
7. **Регулярно обновляйте зависимости**
8. **Используйте firewall** для дополнительной защиты
9. **Настройте мониторинг** для обнаружения аномалий
10. **Регулярно проверяйте логи** на подозрительную активность

## Мониторинг безопасности

- Логируются все попытки превышения rate limit
- Логируются все ошибки авторизации
- Логируются все невалидные запросы
- Отслеживаются отозванные токены

## Обновление зависимостей

Регулярно проверяйте и обновляйте зависимости:

```bash
pip list --outdated
pip install --upgrade <package>
```

## Сообщение об уязвимостях

Если вы обнаружили уязвимость, пожалуйста, сообщите об этом ответственно.

